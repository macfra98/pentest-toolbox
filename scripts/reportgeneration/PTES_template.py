from docx import Document
from docx.shared import Inches
from infogen import *

def document_template():
    document = Document()
    
    client = key_setup()
    discovered_vulns = get_vuln_info()
    findings = get_findings_info(discovered_vulns)
    
    print("This might take a while...")
    print("[+] Generating the report")

    recommendations = generate_recommendations(client, findings) 
    full_methodology = generate_methodology(client)

    
    date_name_org = document.add_paragraph(f"""Name: temp\nDate: temp\nOrg: temp\n""")
    document.add_heading("Pentest Report", 0)
    p1_p = document.add_paragraph("Vulnerabilityanalys of XXXXXX")
    document.add_page_break()    

    p = document.add_heading("Summary", 1)
    document.add_page_break()    
    
    p2_p1_h = document.add_heading("Methodology", 1)
    p2_p1_h_text = document.add_paragraph("The Penetration Testing Execution Standard (PTES) is a detailed guide for conducting penetration tests, created by security experts. It standardizes testing methods, helping security professionals and businesses. It covers testing from planning to reporting, and emphasizes a tailored approach for each organization's needs. The PTES improves penetration testing effectiveness.")
    
    for section, desc in full_methodology.items():
        p2_p2 = document.add_heading(section, 2)
        p2_p2_text = document.add_paragraph(desc)

    p3_p1_h = document.add_heading("Results", 1)
    p3_p1_h_text = document.add_paragraph("Result presents all the findings, how, and why the finding was discovered. Results also presents if the discovered vulnerability is a threat.")
    document.add_page_break()    
    
    p4_p1_h = document.add_heading("Recommendations", 1)
    p4_p1_h_text = document.add_paragraph("Recommendations presents all the recommendations for mitigating and avoiding these types of vulnerabilities.")

    for vuln_name, vuln_desc in recommendations.items():
        p4_p = document.add_heading(vuln_name, 3)
        p4_p = document.add_paragraph(vuln_desc)

    document.add_page_break()

    return document
